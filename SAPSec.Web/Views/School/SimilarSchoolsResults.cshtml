@using SAPSec.Web.ViewModels
@model SimilarSchoolsPageViewModel

@{
    var currentSchoolUrn = ViewContext.RouteData.Values["urn"]?.ToString() ?? Model.Urn.ToString();
}

@if (Model.Schools.Any())
{
    @* Sort dropdown *@
    <div class="govuk-form-group app-similar-schools-sort">
        <label class="govuk-label app-similar-schools-sort__label" for="sort-by">Sort by</label>
        <select class="govuk-select app-similar-schools-sort__select" id="sort-by" name="sortBy" form="similar-schools-filter-form">
            @foreach (var option in Model.SortOptions)
            {
                <option value="@option.Key" selected="@(option.Selected ? "selected" : null)">@option.Name</option>
            }
        </select>
    </div>

    <div class="results-bar govuk-!-margin-bottom-1">
        <p class="govuk-body app-school-results-count">
            Showing <strong>@Model.ShowingFrom-@Model.ShowingTo</strong> of <strong>@Model.TotalResults</strong> similar schools
        </p>

        <!-- Parent view will move the toggle link into here -->
        <div id="resultsBarActions"></div>
    </div>
    
    <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-4">

    <ul class="govuk-list app-school-results">
        @foreach (var school in Model.Schools)
        {
            <li class="app-school-result" id="similar-school-@school.Urn">
                <a class="govuk-link govuk-link--no-visited-state govuk-!-font-weight-bold"
                   href="@Url.Action("Index", "SimilarSchoolsComparison", new { urn = currentSchoolUrn, similarSchoolUrn = string.IsNullOrWhiteSpace(school.UrnRaw) ? school.Urn.ToString() : school.UrnRaw })">
                    @school.EstablishmentName
                </a>
                <p class="govuk-body-s govuk-!-margin-top-1 govuk-!-margin-bottom-0">
                    @school.FullAddress
                </p>
                <p class="govuk-body-s govuk-!-margin-top-1 govuk-!-margin-bottom-0">
                    <strong>@school.SortMetricName:</strong> @school.SortMetricDisplayValue
                </p>
            </li>
        }
    </ul>
}
else
{
    <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-4">
    <p class="govuk-body">No similar schools found matching your filters. Try removing some filters to see more results.</p>
}



