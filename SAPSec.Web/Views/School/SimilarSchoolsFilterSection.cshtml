@using SAPSec.Web.ViewModels
@model FilterCheckboxGroupModel

@{
    var sectionId = $"filter-{Model.Name}";
    var hasSelection = Model.SelectedValues?.Any() == true;
    var isExpanded = hasSelection ? "true" : "false";
}

<div class="app-filter-section app-filter-section--divider" data-module="app-filter-section">
    <button type="button"
            class="app-filter-section__toggle"
            aria-expanded="@isExpanded"
            aria-controls="@sectionId">
        <span class="app-filter-section__title">@Model.Legend</span>
        <span class="app-filter-section__indicator">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd"
                      d="M11.9999 10.5177L17.7928 16.3105L19.207 14.8963L11.9999 7.68923L4.79282 14.8963L6.20703 16.3105L11.9999 10.5177Z"
                      fill="currentColor"></path>
            </svg>
        </span>
    </button>

    <div class="app-filter-section__content" id="@sectionId" @(hasSelection ? "" : "hidden")>
        @if (Model.IsSingleSelect)
        {
            @* Radio buttons for single-select filters *@
            <div class="govuk-radios govuk-radios--small">
                @foreach (var option in Model.Options)
                {
                    var isChecked = Model.SelectedValues?.Contains(option) == true;
                    var inputId = $"{Model.Name}-{option.Replace(" ", "-").Replace("%", "pct").Replace("(", "").Replace(")", "").ToLower()}";
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input"
                               id="@inputId"
                               name="@Model.Name"
                               type="radio"
                               value="@option"
                               @(isChecked ? "checked" : "")>
                        <label class="govuk-label govuk-radios__label" for="@inputId">
                            @option
                        </label>
                    </div>
                }
            </div>
        }
        else
        {
            @* Checkboxes for multi-select filters *@
            <div class="govuk-checkboxes govuk-checkboxes--small">
                @foreach (var option in Model.Options)
                {
                    var isChecked = Model.SelectedValues?.Contains(option) == true;
                    var inputId = $"{Model.Name}-{option.Replace(" ", "-").Replace("(", "").Replace(")", "").ToLower()}";
                    <div class="govuk-checkboxes__item">
                        <input class="govuk-checkboxes__input"
                               id="@inputId"
                               name="@Model.Name"
                               type="checkbox"
                               value="@option"
                               @(isChecked ? "checked" : "")>
                        <label class="govuk-label govuk-checkboxes__label" for="@inputId">
                            @option
                        </label>
                    </div>
                }
            </div>
        }
    </div>
</div>
