@using SAPSec.Web.ViewModels
@model SimilarSchoolsPageViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "View similar schools";
}

<span class="govuk-caption-xl">@Model.EstablishmentName</span>
<h1 class="govuk-heading-xl">@ViewData["Title"]</h1>

<p class="govuk-body">
    We've identified <strong>@Model.TotalResults</strong> similar @Model.PhaseOfEducation.ToLower() phase schools.
    Select a school to compare further and connect with for support. You can also refine the results by applying filters.
</p>
<p class="govuk-body">
    Find out <a href="@Url.Action("WhatIsASimilarSchool", "School", new { urn = Model.Urn })" class="govuk-link">how DfE identifies what a similar school is</a>.
</p>

<div class="govuk-grid-row">

    @* ── Left column: MOJ filters ── *@
    <partial name="SimilarSchoolsFilter" model="Model" />

    @* ── Right column: Sort + Results + Pagination ── *@
    <div class="govuk-grid-column-two-thirds">

        @* Sort dropdown *@
        <div class="govuk-form-group govuk-!-margin-bottom-4">
            <label class="govuk-label govuk-!-display-inline govuk-!-font-weight-bold" for="sort-by">Sort by</label>
            <select class="govuk-select" id="sort-by" name="sortBy" form="similar-schools-filter-form">
                @foreach (var option in FilterOptions.SortOptions)
                {
                    <option value="@option" selected="@(option == Model.SortBy ? "selected" : null)">@option</option>
                }
            </select>
        </div>

        @* Results count + View on map *@
        <div class="results-bar">
            <p class="govuk-body app-school-results-count" style="display:inline">
                Showing <strong>@Model.ShowingFrom-@Model.ShowingTo</strong> of <strong>@Model.TotalResults</strong> similar schools
            </p>
            <span class="govuk-!-margin-left-4">
                <a href="#" class="govuk-link govuk-link--no-visited-state">
                    <span aria-hidden="true">📍</span> View on map
                </a>
            </span>
        </div>

        @* Results list *@
        <partial name="SimilarSchoolsResults" model="Model" />

        @* Pagination *@
        @if (Model.TotalPages > 1)
        {
            <partial name="SimilarSchoolsPagination" model="Model" />
        }
    </div>
</div>

<script add-nonce="true">
    (function () {
        var sortSelect = document.getElementById('sort-by');
        if (sortSelect) {
            sortSelect.addEventListener('change', function () {
                var form = document.getElementById('similar-schools-filter-form');
                if (form) form.submit();
            });
        }
    })();
</script>
